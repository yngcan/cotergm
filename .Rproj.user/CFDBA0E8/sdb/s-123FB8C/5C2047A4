{
    "contents" : "---\ntitle: \"coevolution STERGM\"\nauthor: \"Kirk Li\"\ndate: \"09/23/2014\"\noutput: html_document\n---\n# Coevolution STERGM\n###############################################################################\n```{r}\n\nsource(\"/home/kirk/Dropbox/hiv_network/workspace/kk_utils/utils.R\", echo=FALSE, encoding=\"UTF-8\")\nsource(\"/home/kirk/Dropbox/hiv_network/workspace/cotergm/R/functions.R\",echo=FALSE, encoding=\"UTF-8\")\nset.seed(1234)\nfig.path = \"figures/\"\n# .libPaths(cotergm_path_linux)\nlibrary(\"statnet.common\",lib=cotergm_path_linux)\nlibrary(\"network\",lib=cotergm_path_linux)\nlibrary(\"ergm\",lib=cotergm_path_linux)\nlibrary(\"tergm\",lib=cotergm_path_linux)\n\n```\nInitialize two network panels, each has 20 nodes, 0.2 edge density and 0.5 positive node density.\nWe assume one network evolves to another network.  \n\n\nFirst network \n```{r}\nn <- 20\ny0 <- network(n,density=0.2,directed=FALSE)\ny0 %v% \"status\" <- c(rep(c(2,1),each=n/2))\n#\"+\" is 2, \"-\" is 1\ny0%v%\"status\"\n```\n\n\nSecond network\n```{r}\nnw <-  network(n,density=0.2,directed=FALSE)\nnw %v% \"status\" <- c(sample(c(2,1),n,replace=T))\nnw%v%\"status\"\n```\n\n\nWe decompose the network evolution into four simultaneous modules, in each module, only nodes of one status can either form ties or dissolve ties, but not both. \n\n* F+ Formation network initiated by \"+\" actors \nOnly the empty dyads that involve at least one \"+\" actor may form ties, and only the \"+\" actors may change its nodal status to \"-\"\n* F- Formation network initiated by \"-\" actors \nOnly the empty dyads that involve at least one \"-\" actor may form ties, and only the \"-\" actors may change its nodal status to \"+\"\n* D+ Dissolution network initiated by \"+\" actors\nOnly the non-empty dyads that involve at least one \"+\" actor may dissolve ties, and only the \"+\" actors may change its nodal status to \"-\"\n* D- Dissolution network initiated by \"-\" actors\nOnly the non-empty dyads that involve at least one \"-\" actor may dissolve ties, and only the \"-\" actors may change its nodal status to \"-\"\n\n\n```{r}\n# Formation Plus Network\nFP <- FP.nw(y0,nw,\"status\")\n# Formation Minus Network\nFM <- FM.nw(y0,nw,\"status\")\n# Dissolution Plus Network\nDP <- DP.nw(y0,nw,\"status\")\n# Dissolution Minus Network\nDM <- DM.nw(y0,nw,\"status\")\n```\n\n```{r}\n# pdf(paste0(fig.path,\"0922.pdf\"),height=10,width=10)\nlayout_mat <- matrix(c(7,2,8,1,3,6,1,4,6,0,5,0),4,3,byrow=T)\npar(mar=c(2,2,3,2))\nlayout(layout_mat)\n#\np1 <- plot(y0,edge.col=1,edge.lwd=5,vertex.cex=2,vertex.col=\"status\",cex.lab=2,main=\"y0\",cex.main=2,displaylabels=T,cex.lab=1)\n\np1.1 <- plot(y0,edge.col=1,edge.lwd=5,vertex.cex=2,vertex.col=\"status\",cex.lab=2,coord=p1,main=\"F+\",cex.main=2,displaylabels=T,cex.lab=1)\nplot(FP,coord=p1,new=FALSE,vertex.cex=2,vertex.col=\"status\",cex.lab=2,edge.col=3)\n#\n#\np2 <- plot(y0,edge.col=1,edge.lwd=5,vertex.cex=2,vertex.col=\"status\",cex.lab=2,coord=p1,main=\"F-\",cex.main=2,displaylabels=T,cex.lab=1)\nplot(FM,coord=p1,new=FALSE,vertex.cex=2,vertex.col=\"status\",cex.lab=2,edge.col=3)\n\np3 <- plot(y0,edge.col=\"yellow\",edge.lwd=5,vertex.cex=2,vertex.col=\"status\",cex.lab=2,coord=p1,main=\"D+\",cex.main=2,displaylabels=T,cex.lab=1)\nplot(DP,coord=p1,new=FALSE,vertex.cex=2,vertex.col=\"status\",cex.lab=2,edge.col=1)\n\np4 <- plot(y0,edge.col=\"yellow\",edge.lwd=5,vertex.cex=2,vertex.col=\"status\",cex.lab=2,coord=p1,main=\"D-\",cex.main=2,displaylabels=T,cex.lab=1)\nplot(DM,coord=p1,new=FALSE,vertex.cex=2,vertex.col=\"status\",cex.lab=2,edge.col=1)\n\np5 <- plot(nw,edge.col=1,edge.lwd=5,vertex.cex=2,vertex.col=\"status\",cex.lab=2,coord=p1,main=\"y1\",cex.main=2,displaylabels=T,cex.lab=1,vertex.sides=ifelse(y0 %v% \"status\" == nw %v% \"status\",50,3))\n#\np7 <- plot.new()\nlegend(\"topleft\",legend=c(\"+\",\"-\"),pch=19,col=c(2,1),cex=2,bty=\"n\")\n\np8 <- plot.new()\nlegend(\"topleft\",legend=c(\"tie formed\",\"tie dissolved\",\"nodal status changed\"),lty=c(1,1,NA),pch=c(NA,NA,24), col=c(3,\"yellow\",1),cex=2,bty=\"n\")\n#\n#dev.off()\n```\n\n```{r}\nsummary(y0~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\nsummary(nw~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\nsummary(FP~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\nsummary(FM~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\nsummary(DP~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\nsummary(DM~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\n```\n\n```{r, warning=FALSE}\nfit1 <- ergm(FP~edges+plus+nodematch_cotergm(\"status\",diff=TRUE),control=control.ergm(MCMC.burnin=10000,MCMC.samplesize=10000,MCMC.interval=100,MCMLE.maxit=20,MCMLE.min.effectiveSize=20,MCMC.max.interval=100), constraints=~atleastnonminus(y0),verbose=0)\nfit1\nmcmc.diagnostics(fit1, vars.per.page=4)\n```\n\n\n```{r, warning=FALSE}\nfit2 <- ergm(FM~edges+plus+nodematch_cotergm(\"status\",diff=TRUE),control=control.ergm(MCMC.burnin=10000,MCMC.samplesize=10000,MCMC.interval=100,MCMLE.maxit=20,MCMLE.min.effectiveSize=20,MCMC.max.interval=100), constraints=~atleastnonplus(y0),verbose=0)\nfit2\nmcmc.diagnostics(fit2, vars.per.page=4)\n```\n\n```{r, warning=FALSE}\nfit3 <- ergm(DP~edges+plus+nodematch_cotergm(\"status\",diff=TRUE),control=control.ergm(MCMC.burnin=10000,MCMC.samplesize=10000,MCMC.interval=100,MCMLE.maxit=20,MCMLE.min.effectiveSize=20,MCMC.max.interval=100), constraints=~atmostnonminus(y0),verbose=0)\nfit3\nmcmc.diagnostics(fit3, vars.per.page=4)\n```\n\n```{r, warning=FALSE}\nfit4 <- ergm(DM~edges+plus+nodematch_cotergm(\"status\",diff=TRUE),control=control.ergm(MCMC.burnin=10000,MCMC.samplesize=10000,MCMC.interval=100,MCMLE.maxit=20,MCMLE.min.effectiveSize=20,MCMC.max.interval=100), constraints=~atmostnonplus(y0),verbose=0)\nfit4\nmcmc.diagnostics(fit4, vars.per.page=4)\n```\n\n\n```{r}\nS1 <- simulate(fit1,nsim=1000,statsonly=T)\nS2 <- simulate(fit2,nsim=1000,statsonly=T)\nS3 <- simulate(fit3,nsim=1000,statsonly=T)\nS4 <- simulate(fit4,nsim=1000,statsonly=T)\n\nSUM1 <- summary(FP~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\nSUM2 <- summary(FM~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\nSUM3 <- summary(DP~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\nSUM4 <- summary(DM~edges+plus+nodematch_cotergm(\"status\",diff=TRUE))\n```\n\n```{r}\npar(mfrow=c(4,4))\nhist(S1[,1],main=\"FP\",xlab=names(SUM1)[1])\nabline(v=SUM1[1],col=2,lwd=4)\nhist(S1[,2],main=\"FP\",xlab=names(SUM1)[2])\nabline(v=SUM1[2],col=2,lwd=4)\nhist(S1[,3],main=\"FP\",xlab=names(SUM1)[3])\nabline(v=SUM1[3],col=2,lwd=4)\nhist(S1[,4],main=\"FP\",xlab=names(SUM1)[4])\nabline(v=SUM1[4],col=2,lwd=4)\n\n\n\nhist(S2[,1],main=\"FM\",xlab=names(SUM2)[1])\nabline(v=SUM2[1],col=2,lwd=4)\nhist(S2[,2],main=\"FM\",xlab=names(SUM2)[2])\nabline(v=SUM2[2],col=2,lwd=4)\nhist(S2[,3],main=\"FM\",xlab=names(SUM2)[3])\nabline(v=SUM2[3],col=2,lwd=4)\nhist(S2[,4],main=\"FM\",xlab=names(SUM2)[4])\nabline(v=SUM2[4],col=2,lwd=4)\n\n\nhist(S3[,1],main=\"DP\",xlab=names(SUM3)[1])\nabline(v=SUM2[1],col=2,lwd=4)\nhist(S3[,2],main=\"DP\",xlab=names(SUM3)[2])\nabline(v=SUM2[2],col=2,lwd=4)\nhist(S3[,3],main=\"DP\",xlab=names(SUM3)[3])\nabline(v=SUM3[3],col=2,lwd=4)\nhist(S3[,4],main=\"DP\",xlab=names(SUM3)[4])\nabline(v=SUM3[4],col=2,lwd=4)\n\n\n\nhist(S4[,1],main=\"DM\",xlab=names(SUM4)[1])\nabline(v=SUM4[1],col=2,lwd=4)\nhist(S4[,2],main=\"DM\",xlab=names(SUM4)[2])\nabline(v=SUM4[2],col=2,lwd=4)\nhist(S4[,3],main=\"DM\",xlab=names(SUM4)[3])\nabline(v=SUM4[3],col=2,lwd=4)\nhist(S4[,4],main=\"DM\",xlab=names(SUM4)[4])\nabline(v=SUM4[4],col=2,lwd=4)\n```\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1412278531696.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2613060538",
    "id" : "5C2047A4",
    "lastKnownWriteTime" : 1412280152,
    "path" : "~/Dropbox/hiv_network/workspace/cotergm/Rmd/cotergm.Rmd",
    "project_path" : "Rmd/cotergm.Rmd",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}